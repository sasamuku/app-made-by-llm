# 次に行うべき開発の方針

本ドキュメントでは、以下の2つのPRDで示された要件 (初期プロダクトPRD・タスクタグ機能PRD) を踏まえ、次フェーズで取り組む開発内容について整理します。

---
## 1. 概要

- タスク管理アプリケーションの主要機能（タスクのCRUD、プロジェクト管理、タグ管理）を強化しつつ、認証・権限管理やチームでのタスク共有を実装する
- タスクタグ機能を活用し、タスク検索/フィルタリングをより効率的に行えるUI/UXの改善を行う
- hoge

-----
## 2. 開発優先度

1. 認証機能の強化
   - Supabase Authでの認証フローを確立し、ユーザ情報を管理する
   - ロールベース、またはユーザの種別に応じてアクセス制御を行う仕組みを検討

2. タスク管理全般の改善
   - タスクに対する進捗ステータス（例: To Do / In Progress / Done）の導入
   - 期限や担当者の管理を考慮した拡張
   - プロジェクトとの紐付けを踏まえた詳細UIの設計

3. タグ管理機能のUI/UX強化
   - タグの作成/編集UIを改善し、より直感的に扱えるようにする
   - タグフィルタ操作性の向上 (複数タグの組み合わせフィルターやタグ一覧のソート)
   - 大量のタグを管理できる仕組み (タグの検索/グルーピングなど)

4. チーム共有機能の実装
   - タスクを複数メンバーに共有可能にする
   - タスクのコメント機能や履歴管理を検討
   - プロジェクト単位でのメンバー管理や招待機能

5. CI/CD・マイグレーション管理
   - GitHub ActionsでPR作成時に自動でデータベーススキーママイグレーションを検証
   - 障害報告書のテンプレート整備 (失敗時にIncident Reportを作成する運用フロー確立)

---
## 3. スキーマ設計・マイグレーションの方針

1. **最小限のスキーマから開始する**
   - 既存のテーブル構造に対し必要最低限の新規カラム/テーブルを追加
   - スキーマは将来的に100回以上のマイグレーションを行い、絶えず改善

2. **正規化と非正規化のバランス**
   - タグ機能のための中間テーブルを保持しつつ、検索性能向上のための適切な非正規化を導入
   - 大量データが予想されるテーブルへ適切にインデックスを追加

3. **権限管理用テーブルの設計**
   - ユーザロールを付与するためのテーブル (例: `UserRole`、`TeamMember` など) を順次追加
   - プロジェクト・チームごとの権限を管理する仕組みを整備

4. **マイグレーションガイドライン**
   - 1つの機能追加の単位に対して1つのマイグレーションを行う
   - スキーマを変更した理由を /docs/incident-report や PR説明文等に明記
   - 失敗時は速やかに障害報告書を作成し、ロールバックを検討

---
## 4. 実装計画

### Phase 1: 認証機能の着手
- Supabase Authの設定・調整
- ログイン/ログアウト、登録、アカウント設定UIの追加
- ユーザ情報をセキュアに扱うためのバックエンドAPI整備

### Phase 2: タスク管理・タグ管理の拡充
- 進捗バリエーション追加 (To Do / In Progress / Doneなど)
- タグ管理機能のUI/UX強化
- フィルタリング機能の最適化(タグの組み合わせ、複数条件指定)

### Phase 3: チーム共有機能の導入
- プロジェクト/チームごとのユーザ管理テーブル追加
- 招待フロー、コメント機能の検討・実装
- 共有タスクの編集権限・操作権限設定

### Phase 4: CI/CD 強化
- GitHub Actionsでの自動ビルド/テスト/マイグレーション手順を明確化
- データベースパフォーマンス計測を行い、インデックスやスキーマ最適化を継続

---
## 5. リスクと対策

- **UXの複雑化**: 多数の機能追加でUIが煩雑になる恐れ
  → UIフローを簡素化しつつ必要な機能を整理し、テストを通じて改善
- **スキーマ変更反映の失敗**: マイグレーション時の不整合
  → 事前にローカル環境で検証し、PR作成時にCIで自動検証
- **チーム共有機能の大規模化**: 役割や権限設定が複雑化
  → まずは最小限の管理テーブルから導入し、段階的に機能拡大

---
## 6. 今後のアクション

- この開発方針に沿ってブランチを切り、各フェーズごとに細かいPRを出していく
- スキーマ変更のたびにマイグレーションを作成し、CIで自動実行が可能な状態を保つ
- `/docs/prd/`および `/docs/tech-design/` ディレクトリに設計ドキュメントを追加して、随時更新しながら開発を継続する

本ドキュメントは必要に応じてアップデートし、開発に合わせて柔軟に拡張していきます。
